

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frequently Asked Questions &mdash; suite2p 0.6.17 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Registration" href="registration.html" />
    <link rel="prev" title="Multiday recordings" href="multiday.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> suite2p
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basics:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings (ops.npy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">Using the GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiday.html">Multiday recordings</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cropped-field-of-view">Cropped field-of-view</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deconvolution-means-what">Deconvolution means what?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-functional-channels">Multiple functional channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#z-drift">Z-drift</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">How it works:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="celldetection.html">Cell detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="roiextraction.html">Signal extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="deconvolution.html">Spike deconvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">suite2p</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Frequently Asked Questions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/FAQ.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cropped-field-of-view">
<h2>Cropped field-of-view<a class="headerlink" href="#cropped-field-of-view" title="Permalink to this headline">¶</a></h2>
<p>Some issues on this: <a class="reference external" href="https://github.com/MouseLand/suite2p/issues/273">#273</a>,
<a class="reference external" href="https://github.com/MouseLand/suite2p/issues/207">#207</a>,
<a class="reference external" href="https://github.com/MouseLand/suite2p/issues/125">#125</a>.</p>
<p>Why does this happen? suite2p crops the field-of-view so that areas that move out of
view on the edges are not used for ROI detection and signal extraction. These areas are
excluded because they are not always in the FOV - they move in and out and therefore
activity in these regions is unreliable to estimate.</p>
<p>suite2p determines the region to crop based on the maximum rigid shifts in XY. You can view
these shifts with the movie in the “View registered binary” window. If these shifts are too large
and don’t seem to be accurate (low SNR regime), you can decrease the maximum shift that suite2p can
estimate by setting ops[‘maxregshift’] lower than its default (which is 0.1 = 10% of the size of the FOV).
suite2p does exclude some of the large outlier shifts when computing the crop, and determines the threshold
of what is an “outlier” using the parameter ops[‘th_badframes’]. Set this lower to increase the number of
“outliers”. These “outliers” are labelled as ops[‘badframes’] and these frames are excluded also from ROI detection.</p>
<p>You can add frames to this list of ops[‘badframes’] by creating
a numpy array (0-based, the first frame is zero) and save it as bad_frames.npy in the folder
with your tiffs (if you have multiple folders, save it in the FIRST folder with tiffs,
or if you have subfolders with ‘look_one_level_down’ it should be in the parent folder).
See this page <span class="xref std std-ref">inputs</span>
for more info.</p>
</div>
<div class="section" id="deconvolution-means-what">
<h2>Deconvolution means what?<a class="headerlink" href="#deconvolution-means-what" title="Permalink to this headline">¶</a></h2>
<p>There is a lot of misinformation about what deconvolution is and what it isn’t. Some issues on this:
<a class="reference external" href="https://github.com/MouseLand/suite2p/issues/267">#267</a>,
<a class="reference external" href="https://github.com/MouseLand/suite2p/issues/202">#202</a>,
<a class="reference external" href="https://github.com/MouseLand/suite2p/issues/169">#169</a></p>
<p>TLDR: Deconvolution will NOT tell you how many spikes happened in a neuron - there is too much
variability in the calcium signal to know that. Our deconvolution has NO sparsity constraints
and we recommend against thresholding the output values because they contain information about
approximately how many spikes occurred. We found that using the raw deconvolved values gave us
the most reliable responses to stimuli (as measured by signal variance).</p>
<p>See this figure from our <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0959438818300977">review paper</a> for reference:</p>
<a class="reference internal image-reference" href="_images/fig4_review.png"><img alt="_images/fig4_review.png" src="_images/fig4_review.png" style="width: 600px;" /></a>
<p>Long answer (mostly from #267):</p>
<p>There is an unknown scaling factor between fluorescence and # spikes, which is very hard to estimate.
This is true both for the raw dF, or dF/F, and for the deconvolved amplitudes, which we usually treat
as arbitrary units. The same calcium amplitude transient may have been generated by a single spike,
or by a burst of many spikes, and for many neurons it is very hard to disentangle these, so we don’t
try. Few spike deconvolution algorithms try to estimate single spike amplitude (look up “MLspike”),
but we are in general suspicious of the results, and usually have no need for absolute numbers of
spikes.</p>
<p>As for the question of thresholding, we always recommend not to, because you will lose information.
More importantly, you will treat 1-spike events the same as 10-spike events, which isn’t right.
There are several L0-based methods that return discrete spike times, including one we’ve developed
in the past, which we’ve since shown to be worse than the vanilla OASIS method
(see our <a class="reference external" href="https://www.jneurosci.org/content/38/37/7976.abstract">Jneurosci paper</a>).
We do not use L1 penalties either, departing from the original OASIS paper, because we
found that hurts in all cases (see Jneurosci).</p>
<p>How do you compare across cells then if these values are arbitrary to some extent?</p>
<p>If you need to compare between cells, you would usually be comparing effect sizes,
such as tuning width, SNR, choice index etc. which are relative quantities, i.e.
firing rate 1 / firing rate 2. If you really need to compare absolute firing rates,
then you need to normalize the deconvolved events by the F0 of the fluorescence trace,
because the dF/F should be more closely related to absolute firing rate. Computing the
F0 has problems in itself, as it may sometimes be estimated to be negative or near-zero
for high SNR sensors like gcamp6 and 7. You could take the mean F0 before subtracting the
neuropil and normalize by that, and then decide on a threshold to use across all cells,
but at that point you need to realize these choices will affect your result and
interpretation, so you cannot really put much weight on them. For these reasons, I would
avoid making statements about absolute firing rates from calcium imaging data, and I don’t
know of many papers that make such statements.</p>
</div>
<div class="section" id="multiple-functional-channels">
<h2>Multiple functional channels<a class="headerlink" href="#multiple-functional-channels" title="Permalink to this headline">¶</a></h2>
<p>If you have two channels and they both have functional activity, then to
process both you need to run suite2p in a jupyter notebook. Here is an example
notebook for that purpose: <a class="reference external" href="https://github.com/MouseLand/suite2p/blob/master/jupyter/multiple_functional_channels.ipynb">multiple_functional_channels.ipynb</a></p>
</div>
<div class="section" id="z-drift">
<h2>Z-drift<a class="headerlink" href="#z-drift" title="Permalink to this headline">¶</a></h2>
<p>It’s not frequently asked about but it should be :)</p>
<p>In the GUI in the “View registered binary” window you can now load in a z-stack
and compute the z-position of the recording across time.</p>
<p>Scanimage now can do z-correction ONLINE for you!</p>
<a class="reference internal image-reference" href="_images/scanimage.png"><img alt="_images/scanimage.png" src="_images/scanimage.png" style="width: 600px;" /></a>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="registration.html" class="btn btn-neutral float-right" title="Registration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multiday.html" class="btn btn-neutral float-left" title="Multiday recordings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Carsen Stringer, Marius Pachitariu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>